@page
@model InfocommSolutionsProject.Pages.DashboardModel
@{
    ViewData["Title"] = "Data Visualisation";
   
}

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      // Real-time Chart Example written by Simon Brunel (Plunker: https://plnkr.co/edit/Imxwl9OQJuaMepLNy6ly?p=info)
      var samples = 100;
      var speed = 250;
      var values0 = [];
      var values1 = [];
       var values2 = [];
         var values3 = [];
      var labels = [];
      var charts = [];
      //var value = 0;
      
      values0.length = samples;
      values1.length = samples;
       values2.length = samples;
         values3.length = samples;
      labels.length = samples;
      values0.fill(0);
      values1.fill(0);
        values2.fill(0);
          values3.fill(0);
      labels.fill(0);

      charts.push(new Chart(document.getElementById("chart0"),
        {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                data: values0,
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                borderColor: 'rgb(255, 99, 132)',
                borderWidth: 2,
                lineTension: 0.25,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: false,
            animation: {
              duration: speed * 1.5,
              easing: 'linear'
            },
            legend: false,
            scales: {
              xAxes: [
                {
                  display: false
                }
              ],
              yAxes: [
                {
                  ticks: {
                    max: 50,
                    min: -10
                  }
                }
              ]
            }
          }
        }),
        new Chart(document.getElementById("chart1"),
        {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                data: values1,
                backgroundColor: 'rgba(71, 148, 254, 0.1)',
                borderColor: 'rgb(71, 148, 254)',
                borderWidth: 2,
                lineTension: 0.25,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: false,
            animation: {
              duration: speed * 1.5,
              easing: 'linear'
            },
            legend: false,
            scales: {
              xAxes: [
                {
                  display: false
                  
                }
              ],
              yAxes: [
                {
                  ticks: {
                    max: 80,
                    min: 20
                  }
                }
              ]
            }
          }
        }),
        new Chart(document.getElementById("chart2"),
        {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                data: values2,
                backgroundColor: 'rgba(71, 148, 254, 0.1)',
                borderColor: 'rgb(71, 148, 254)',
                borderWidth: 2,
                lineTension: 0.25,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: false,
            animation: {
              duration: speed * 1.5,
              easing: 'linear'
            },
            legend: false,
            scales: {
              xAxes: [
                {
                  display: false
                  
                }
              ],
              yAxes: [
                {
                  ticks: {
                    max: 80,
                    min: 20
                  }
                }
              ]
            }
          }
        }),
        new Chart(document.getElementById("chart3"),
        {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                data: values3,
                backgroundColor: 'rgba(71, 148, 254, 0.1)',
                borderColor: 'rgb(71, 148, 254)',
                borderWidth: 2,
                lineTension: 0.25,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: false,
            animation: {
              duration: speed * 1.5,
              easing: 'linear'
            },
            legend: false,
            scales: {
              xAxes: [
                {
                  display: false
                  
                }
              ],
              yAxes: [
                {
                  ticks: {
                    max: 80,
                    min: 20
                  }
                }
              ]
            }
          }
        }));
      
      var connection = new signalR.HubConnectionBuilder().withUrl("/sensor").build();
        //var connection = new signalR.HubConnection("/sensor");
      connection.on('Broadcast',
        function (sender, message) {
          var TheData = JSON.parse(message);
          //console.log(TheData.temperature);
          //console.log(TheData["humidity"]);
          //console.log(sender);
          values0.push(TheData["temperature"]);
          //console.log(TheData);
          values0.shift();
          charts[0].update();

          values1.push(TheData["humidity"]);
          values1.shift();
          charts[1].update();
          
          //hj added chart 2 , 3 

          values2.push(TheData["lightValue"]);
          values2.shift();
          charts[2].update();

          values3.push(TheData["moisture"]);
          values3.shift();
          charts[3].update();
        });
       
      connection.start();
    });
  </script>

<h1>IoT Sensor Data</h1>
<h2>Temperature</h2>
<canvas id="chart0" style="width:512px;height:320px"></canvas>
<h2>Humidity</h2>
<canvas id="chart1" style="width:512px;height:320px"></canvas>
<h2>lightValue</h2>
<canvas id="chart2" style="width:512px;height:320px"></canvas>
<h2>moisture</h2>
<canvas id="chart3" style="width:512px;height:320px"></canvas>